<!DOCTYPE html>
<html>
<head>
    <title>Agape Debug Tool</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .error { color: #ff6b6b; background: #2d1b1b; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .warning { color: #ffd93d; background: #2d2a1b; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .info { color: #6bcf7f; background: #1b2d1b; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .section { border: 1px solid #333; padding: 15px; margin: 15px 0; border-radius: 8px; }
        button { background: #0070f3; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0051a2; }
        textarea { width: 100%; height: 200px; background: #2a2a2a; color: #fff; border: 1px solid #555; padding: 10px; }
    </style>
</head>
<body>
    <h1>üîç Agape Debug Console</h1>
    
    <div class="section">
        <h2>üìä Informa√ß√µes do Sistema</h2>
        <div id="systemInfo"></div>
    </div>

    <div class="section">
        <h2>üö® Erros JavaScript</h2>
        <div id="jsErrors"></div>
    </div>

    <div class="section">
        <h2>üåê Requisi√ß√µes de Rede</h2>
        <div id="networkRequests"></div>
    </div>

    <div class="section">
        <h2>üîß Testes de Conectividade</h2>
        <button onclick="testSupabase()">Testar Supabase</button>
        <button onclick="testMainApp()">Testar App Principal</button>
        <button onclick="exportLogs()">Exportar Logs</button>
        <div id="tests"></div>
    </div>

    <div class="section">
        <h2>üìã Log Completo</h2>
        <textarea id="fullLog" readonly placeholder="Logs aparecer√£o aqui..."></textarea>
    </div>

    <script>
        let logs = [];
        let errors = [];
        let networkEvents = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toISOString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logs.push(logEntry);
            
            const element = document.getElementById(type === 'error' ? 'jsErrors' : 'tests');
            if (element) {
                element.innerHTML += `<div class="${type}">${logEntry}</div>`;
            }
            
            updateFullLog();
        }

        function updateFullLog() {
            document.getElementById('fullLog').value = logs.join('\n');
        }

        // Capturar erros JavaScript
        window.addEventListener('error', function(e) {
            const errorMsg = `${e.message} at ${e.filename}:${e.lineno}:${e.colno}`;
            errors.push(errorMsg);
            log(errorMsg, 'error');
        });

        // Capturar erros de Promise rejeitadas
        window.addEventListener('unhandledrejection', function(e) {
            const errorMsg = `Unhandled Promise Rejection: ${e.reason}`;
            errors.push(errorMsg);
            log(errorMsg, 'error');
        });

        // Informa√ß√µes do sistema
        function loadSystemInfo() {
            const info = {
                'User Agent': navigator.userAgent,
                'URL': window.location.href,
                'Referrer': document.referrer || 'N/A',
                'Local Storage Available': !!window.localStorage,
                'Session Storage Available': !!window.sessionStorage,
                'Cookies Enabled': navigator.cookieEnabled,
                'Online': navigator.onLine,
                'Screen': `${screen.width}x${screen.height}`,
                'Viewport': `${window.innerWidth}x${window.innerHeight}`,
                'Timestamp': new Date().toISOString()
            };

            let html = '';
            for (const [key, value] of Object.entries(info)) {
                html += `<div class="info"><strong>${key}:</strong> ${value}</div>`;
            }
            document.getElementById('systemInfo').innerHTML = html;
            
            log(`System Info: ${JSON.stringify(info)}`, 'info');
        }

        // Testar Supabase
        async function testSupabase() {
            log('Testando conectividade com Supabase...', 'info');
            
            try {
                // Verificar vari√°veis de ambiente
                const supabaseUrl = window.location.hostname === 'localhost' ? 
                    'https://temp.supabase.co' : 'VARIAVEL_DO_VERCEL';
                
                log(`Supabase URL configurada: ${supabaseUrl}`, 'info');
                
                // Testar fetch simples
                const response = await fetch('/api/health-check', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    log('‚úÖ API do app respondeu corretamente', 'info');
                } else {
                    log(`‚ùå API retornou erro: ${response.status} - ${response.statusText}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Erro ao testar Supabase: ${error.message}`, 'error');
            }
        }

        // Testar app principal
        async function testMainApp() {
            log('Testando carregamento do app principal...', 'info');
            
            try {
                const response = await fetch('/login', {
                    method: 'GET',
                    headers: { 'Accept': 'text/html' }
                });
                
                if (response.ok) {
                    const html = await response.text();
                    if (html.includes('Agape')) {
                        log('‚úÖ App principal carrega corretamente', 'info');
                    } else {
                        log('‚ö†Ô∏è App carrega mas pode estar com problemas de conte√∫do', 'warning');
                    }
                } else {
                    log(`‚ùå App principal falhou: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Erro ao testar app: ${error.message}`, 'error');
            }
        }

        // Exportar logs
        function exportLogs() {
            const debugData = {
                timestamp: new Date().toISOString(),
                errors: errors,
                logs: logs,
                userAgent: navigator.userAgent,
                url: window.location.href,
                localStorage: { ...localStorage },
                sessionStorage: { ...sessionStorage }
            };
            
            const blob = new Blob([JSON.stringify(debugData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `agape-debug-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('üìÅ Logs exportados com sucesso', 'info');
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemInfo();
            log('üöÄ Debug console iniciado', 'info');
            
            // Auto-executar testes ap√≥s 2 segundos
            setTimeout(() => {
                testSupabase();
                testMainApp();
            }, 2000);
        });
    </script>
</body>
</html>